<!DOCTYPE>
<html>

<head>
    <title> System API 测试页面</title>
</head>

<body>

    <input type="file" id='file' />

    <audio controls id='audio'></audio>


    <script src="FileSystem.js"></script>

    <script>
        file.addEventListener('change', async function (ev) {

            if (this.files) {

                var reader = new FileReader()

                reader.onload = async function (ev) {

                    var fileEntry = await FileSystem.getInstance().then(fs => fs.root.getFile('music/txt.txt')).then(fe => fe.write(ev.target.result))
                    audio.src = window.URL.createObjectURL(fileEntry.file.blob)
                    audio.play()

                }
                reader.readAsArrayBuffer(this.files[0])

            }
        })

        async function test() {
            let fs = await FileSystem.getInstance()
            // 获取目录
            let dir_vbox = await fs.root.getDirectory('vbox')
            let dir_v1 = await dir_vbox.getDirectory('v1')
            let dir_v2 = await dir_v1.getDirectory('v2')
            //getParent 测试 根节点
            await fs.root.getParent().then(f => console.log(f))
            //获取文件，不存在创建
            let f1 = await dir_v2.getFile('天安门.txt')
            // 写入文件
            await f1.write('i 加好么 ok')
            //文件获得父目录
            await f1.getParent().then(d => console.log(d))

            f1.toURL().then(url => console.log(url))

            f1.readAsArrayBuffer().then(b => console.log(b))
            f1.readAsBinaryString().then(b => console.log(b))
            f1.readAsDataURL().then(b => console.log(b))
            f1.readAsText().then(b => console.log(b))
            f1.getBlob().then(b=>console.log(b))
        }
        test()
    </script>
</body>


</html>